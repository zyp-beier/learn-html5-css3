<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>canvas</title>
</head>
<body>
<div>
    <div>
        <canvas id="canvas" width="300" height="300"></canvas>
    </div>
</div>
</body>
<script>
    let canvas = document.getElementById('canvas')
    let context = canvas.getContext('2d');
    // context.fillStyle = '#EEE';
    // context.fillRect(0,0,400,300);


    /*context.fillStyle = 'red';
    context.strokeStyle = 'blue';
    context.lineWidth = 1;
    context.fillRect(50,50,100,100);
    context.strokeRect(50,50,100,100)*/


    /* var n = 0;
     for(let i= 0;i<10;i++){
         // context.beginPath();
         context.arc(i*25,i*25,i*15,0,Math.PI*2,true)
         // context.closePath();
         context.fillStyle = 'rgba(255,0,0,0.25)'
         context.fill()
     }*/
    // 曲线
    /* var dx = 150;
     var dy = 150;
     var s = 100;
      context.beginPath();
      context.globalCompositeOperation = 'and';
      context.fillStyle = 'rgb(100,255,100)';
      // context.strokeStyle = 'rgb(0,0,100)';
     var x = Math.sin(0);
     var y = Math.cos(0);
      var dig = Math.PI / 15 * 11;
      context.moveTo(dx,dy)
      for(var i = 0; i < 30; i++){
          var x = Math.sin(i * dig);
          var y = Math.cos(i * dig);
          context.bezierCurveTo(dx + x * s,dy + y * s - 100,dx + x * s + 100,dy + y * s,dx + x * s,dy + y * s)
          // context.lineTo(dx + x * s,dy + y * s)
      }
      context.closePath();
      context.fill();
      context.stroke()*/

    /******************************************************************/
    // 线性渐变
    /*var g1 = context.createLinearGradient(0,0,0,300)
    g1.addColorStop(0,'rgb(255,255,0)')
    g1.addColorStop(1,'rgb(0,255,255)')
    context.fillStyle = g1;
    context.fillRect(0,0,400,300);
    var n = 0;
    var g2 = context.createLinearGradient(0,0,300,0)
    g2.addColorStop(0,'rgba(0,0,255,0.5)')
    g2.addColorStop(1,'rgba(255,0,0,0.5)')
    for(let i=0; i<10;i++){
        context.beginPath()
        context.fillStyle = g2;
        context.arc(i*25,i*25,i*10,0,Math.PI*2);
        context.closePath()
        context.fill()
    }*/
    /*var g1 = context.createRadialGradient(400,0,0,400,0,400);
    g1.addColorStop(0.1,'rgb(255,255,0)');
    g1.addColorStop(0.3,'rgb(255,0,255)');
    g1.addColorStop(1,'rgb(0,255,255)');
    context.fillStyle = g1;
    context.fillRect(0,0,400,300);
    var n = 0;
    var g2 = context.createRadialGradient(250,250,0,250,250,300);
    g2.addColorStop(0.1,'rgba(255,0,0,0.5)');
    g2.addColorStop(0.7,'rgba(255,255,0,0.5)');
    g2.addColorStop(1,'rgba(0,0,255,0.5)');
    for(let i=0; i<10;i++){
        context.beginPath();
        context.fillStyle = g2;
        context.arc(i*25,i*25,i*10,0,Math.PI*2);
        context.closePath()
        context.fill()
    }*/
    // 坐标变换
    /* context.fillStyle = '#EEE';
     context.fillRect(0,0,400,300);
     //图形绘制
     context.translate(200,50)
     context.fillStyle = 'rgba(255,0,0,0.25)'
     for(var i=0; i<50;i++){
         context.translate(25,25)
         context.scale(0.95,0.95)
         context.rotate(Math.PI/10)
         context.fillRect(0,0,100,50)
     }*/
    //绘制图像
    /*var image = new Image()
    image.src='../resource/background11.jpg'
    image.onload = () => {
        drawImg(context,image)
    }
    function drawImg(context,image) {
        for (let i = 0;i<7;i++){
            context.drawImage(image,0 + i * 50, 0 + i * 25,150,100)
        }
    }*/
    /*var image = new Image()
    image.src='../resource/background11.jpg'
    image.onload = () => {
        drawImg(context,image)
    }
    function drawImg(context,image) {
        context.drawImage(image, 0, 0, 200, 120);
        context.drawImage(image, 3200, 900, 900, 600,150,100,100,100)
    }*/
    //图像平铺
    /* var image = new Image()
     image.src='../resource/background11.jpg'
     image.onload = () => {
         //创建填充样式，全方位平铺
        var ptrn = context.createPattern(image,'repeat')
         // 制定填充样式
         context.fillStyle = ptrn
         context.fillRect(0,0,400,300)
     }*/
    //图像裁剪
    /*var gr = context.createLinearGradient(0,400,300,0)
    gr.addColorStop(0,'rgb(255,255,0)')
    gr.addColorStop(1,'rgb(0,255,255)')
    context.fillStyle = gr
    context.fillRect(0,0,400,300)
    var image = new Image()
    image.src='../resource/background11.jpg'
    image.onload = () => {
        drawImg(context,image)
    };
    function drawImg(context,image) {
        create5StarClip(context)
        context.drawImage(image,-50,-150,300,300)
    }
    function create5StarClip(context) {
        var n = 0;
        var dx = 100;
        var dy = 0;
        var s = 150;
        context.beginPath()
        context.translate(100,150)
        var x = Math.sin(0)
        var y = Math.cos(0)
        var dig = Math.PI / 5 * 4
        for(let i=0;i<5;i++){
            var x = Math.sin(i*dig)
            var y = Math.cos(i*dig)
            context.lineTo(dx+x*s,dy+y*s)
        }
        context.clip()
    }*/
    //像素处理

    let mouseClicked = false;
    canvas.addEventListener("mousedown", function (e) {
        mouseClicked = true;
        render();
    });

    canvas.addEventListener("mouseup", function () {
        mouseClicked = false;
    });

    let mousePosition = {
        x: 0,
        y: 0
    };
    canvas.addEventListener("mousemove", function (e) {
        mousePosition = {
            x: e.layerX,
            y: e.layerY
        }
    });

    let image = new Image();
    image.src = '../resource/user.jpg';

    function render() {
        let imgData = context.getImageData(0, 0, image.width, image.height);
        console.log('render');
        let linePosition = (imgData.width * (mousePosition.y - 1) + mousePosition.y) * 4;

        console.log("position %s", linePosition);
        for (let i = 0, n = imgData.data.length; i < n; i += 4) {


            let r = imgData.data[i];
            let g = imgData.data[i + 1];
            let b = imgData.data[i + 2];

            if (i === linePosition) {
                r = 0;
                g = 255;
                b = 0;
            }
            //
            // if (r < 90 && g < 90 && b < 90) {
            //     r = 0;
            //     g = 255;
            //     b = 0;
            // }

            //

            imgData.data[i] = r;
            imgData.data[i + 1] = g;
            imgData.data[i + 2] = b;
        }
        context.putImageData(imgData, 0, 0)
    }

    image.onload = () => {
        context.drawImage(image, 0, 0, 150, 200);
        console.log()
        render();
    }
    // 绘制文字
    /* context.fillStyle = '#00f'
     context.font = 'italic 30px sans-serif'
     context.textBaseline = 'top'
     //填充字符串0
     context.fillText('示例文字',0,0)
     context.font = 'bold 30px sans-serif';
     //轮廓字符串
     context.strokeText('示例文字',0,50)*/
</script>
</html>
